# CSRF和XSS攻击

## 一、CSRF	

> 什么是CSRF?
>
> CSRF是指攻击者诱导受害者进入第三方网站，在第三方网站中，向被攻击网站发送跨站请求。利用受害者在被攻击网站已经获取的注册凭证，绕过后台的用户验证，达到冒充用户对被攻击的网站执行某项操作的目的

### 1. CSRF攻击的流程

* 用户首先登录一个网站，并登录，在浏览器中保留了登录凭证Cookie
* 攻击者诱导用户点击一个链接进入攻击者的网站
* 攻击者的网站会主动向用户之前登录的网站发送请求，该请求会携带浏览器中保留的凭证Cookie
* 被攻击网站在接收到携带用户Cookie的请求后，会误以为是用户发送的请求
* 使得被攻击网站会执行攻击者网站所发送的请求，损害用户的利益

### 2. CSRF的攻击类型

 **GET类型的CSRF**

GET类型的CSRF一般通过在http请求后面加Param参数来实现的

> 例如：

```js
http://www.xxx.com?account=xxx&&amount=xxx
```

当用户进入的某个页面需要请求加载图片时攻击者网站就会向被攻击网站发动这样的http请求，同时携带用户的登录信息。

**POST类型的CSRF**

POST类型的CSRF通常是通过自动提交一个表单来实现的

> 例如：

```html
<form action="http://www.xxx.com" method="post" id="form">
    <input name="account" value="xxx"/>
    <input name="amount" value="xxx"/>
</form>
<script>
    document.querySelector('#form').submit()
</script>
```

当用户进入某个页面时，会自动提交一个表单到被攻击网站，相当于完成了一次P0ST请求

**链接类型的CSRF**

该类型的攻击通常是一个诱导用户跳转的链接

> 例如：

```html
<a href="http://www.xxx.com?account=xxx&&amount=xxx">
	诱导用户点击的内容
</a>
```

这种类型的攻击在用户不点击链接之前是无法发起的，而前两种类型的攻击只要用户进入了某个页面就会自动发起攻击

# 二、XSS攻击

> 什么是XSS攻击？
>
> XSS攻击通常指的是通过利用网页开发时留下的漏洞，通过巧妙的方法注入恶意指令代码到网页，使用户加载并执行攻击者恶意制造的网页程序。这些恶意网页程序通常是JavaScript，但实际上也可以包括Java、 VBScript、ActiveX、 Flash 或者甚至是普通的HTML。攻击成功后，攻击者可能得到包括但不限于更高的权限（如执行一些操作）、私密网页内容、会话和cookie等各种内容。

## XSS的攻击类型

**1.反射型XSS**

> 反射型XSS攻击的流程

* 攻击者将恶意代码拼接在目标网站的URL中
* 当用户点击含有恶意代码的URL时，目标网站会将恶意代码从URL中取出拼接在返回的HTML中返回给浏览器
* 浏览器解析返回的HTML时，恶意代码也会被执行
* 恶意代码将用户信息返回给攻击者网站，或者执行攻击者指定的操作

**2.存储型XSS**

> 存储型XSS攻击的流程

* 攻击者将恶意代码提交到目标网站的数据库中
* 用户进入目标网站时，目标网站从数据库中取数据时会将恶意代码一块取出并拼接在HTML中返回给浏览器
* 浏览器解析返回的HTML时，恶意代码也会被执行
* 恶意代码将用户信息返回给攻击者网站，或者执行攻击者指定的操作

**3.DOM型XSS**

> DOM型XSS攻击的流程

* 攻击者构造一个含有恶意代码的特殊URL
* 用户点击URL后本地浏览器会解析取出并执行其中的恶意代码
* 恶意代码将用户信息返回给攻击者网站，或者执行攻击者指定的操作

DOM型XSS攻击与反射型的不同之处在于，DOM型攻击解析取出恶意代码的是浏览器端而不是服务器端。